This code was adapted from code graciously provided by Serdiev in https://github.com/Serdiev/splitflap-backend